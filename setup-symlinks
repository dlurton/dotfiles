#!/bin/bash

ME=$(readlink -f $0)
MY_DIR=$(dirname $ME)
source $MY_DIR/util.sh

echo "Searching for files in $MY_DIR/home"

cd $MY_DIR/home

for file in *; do 
    symlink_path=$(readlink -f ~/.$file)
    target=$(readlink -f $file)

    echo "Symlink $symlink_path should point to $target"
    
    if [ -L $symlink_path ]; then 
        echo "$symlink_path is already a symlink"
    else 
        if [ -f $symlink_path ]; then 
            new_name="$symlink_path.old-dotfile"
            echo "$symlink_path is a regular file, renaming to $new_name"
            mv "$symlink_path" "$new_name"
        fi
        ln -s "$target" "$symlink_path"
    fi

done

echo "Done."

